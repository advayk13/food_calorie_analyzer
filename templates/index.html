<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Food Calorie Calculator</title>
  
  <!-- Google Fonts: Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { font-family: 'Poppins', sans-serif; background: #f8f9fa; min-height: 100vh; display: flex; flex-direction: column; animation: fadeIn 1s ease forwards; opacity: 0; }
    @keyframes fadeIn { to { opacity: 1; } }
    .container { margin-top: 50px; margin-bottom: 50px; }
    .card { box-shadow: 0 6px 20px rgba(0,0,0,0.1); border-radius: 12px; background: #fff; padding: 30px; animation: slideUpFade 0.8s ease forwards; opacity: 0; transform: translateY(20px); }
    @keyframes slideUpFade { to { opacity: 1; transform: translateY(0); } }
    h1 { font-weight: 600; color: #007bff; text-align: center; margin-bottom: 30px; text-shadow: 0 2px 6px rgba(0,123,255,0.3); }
    input[type="file"], input[type="number"] { transition: box-shadow 0.3s ease; border-radius: 6px; }
    input:focus { box-shadow: 0 0 8px #007bff; outline: none; }
    button.btn-primary, button.btn-warning { font-weight: 600; border-radius: 8px; padding: 12px; transition: background-color 0.3s ease, transform 0.3s ease; }
    button.btn-primary:hover { background-color: #0056b3; transform: scale(1.05); }
    button.btn-warning:hover { background-color: #e6a500; transform: scale(1.05); }
    img.uploaded-img { max-width: 100%; border-radius: 12px; box-shadow: 0 6px 15px rgba(0,0,0,0.15); transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer; margin-bottom: 20px; }
    img.uploaded-img:hover { transform: scale(1.05); box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
    ul.list-group-item { font-weight: 500; font-size: 1.05rem; transition: background-color 0.2s ease; border-radius: 8px; }
    ul.list-group-item:hover { background-color: #f1faff; }
    .recommendation { font-weight: 700; font-size: 1.2rem; margin-top: 15px; }
    .alert-box { font-weight: 600; font-size: 1.1rem; color: #b30000; background: #ffe6e6; border: 1px solid #ff9999; border-radius: 8px; padding: 12px; text-align: center; }
    @media (max-width: 576px) { .card { padding: 20px; } h1 { font-size: 1.8rem; } }
  </style>
</head>
<body>

  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-7">
        <div class="card">
          <h1>üçΩÔ∏è Food Calorie Calculator</h1>

          <!-- Image upload form -->
          <form method="POST" enctype="multipart/form-data" class="mb-4">
            <div class="mb-3">
              <label for="foodImage" class="form-label fw-semibold">Upload Food Image</label>
              <input class="form-control" type="file" id="foodImage" name="food_image" accept="image/*" {% if prediction %}disabled{% else %}required{% endif %}>
            </div>
            <button type="submit" class="btn btn-primary w-100" {% if prediction %}disabled{% endif %}>Upload & Predict</button>
          </form>

          <!-- üß† Non-food alert message -->
          {% if recommendation and not prediction %}
          <div class="alert-box mb-4">
            {{ recommendation }}
          </div>
          <div class="text-center mb-3">
            <img src="{{ url_for('uploaded_file', filename=filename) }}" alt="Uploaded Image" class="uploaded-img" />
          </div>
          <form method="GET">
            <button type="submit" class="btn btn-warning w-100">Try Another Image</button>
          </form>
          {% endif %}

          {% if prediction %}
          <!-- Show prediction and uploaded image -->
          <hr>
          <h3 class="text-center mb-3 text-success fw-bold">Prediction: {{ prediction }}</h3>
          <div class="text-center mb-4">
            <img src="{{ url_for('uploaded_file', filename=filename) }}" alt="Uploaded Image" class="uploaded-img" />
          </div>

          <!-- Weight input form -->
          <form method="POST" class="mb-4">
            <input type="hidden" name="current_prediction" value="{{ prediction }}">
            <input type="hidden" name="current_file" value="{{ filename }}">
            <input type="hidden" name="top_predictions" value='{{ top_predictions|tojson }}'>

            <div class="mb-3">
              <label for="weight" class="form-label fw-semibold">Enter Weight (grams)</label>
              <input type="number" class="form-control" id="weight" name="weight" min="1" value="{{ weight or '' }}" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Calculate Nutrition</button>
          </form>

          <div class="row">
            <div class="col-md-6">
              <h5 class="fw-semibold">Nutrition {% if weight %}for {{ weight }}g{% else %}per 100g{% endif %}:</h5>
              <ul class="list-group">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  Calories
                  <span class="badge bg-primary rounded-pill">{{ nutrition.calories }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  Protein
                  <span class="badge bg-primary rounded-pill">{{ nutrition.protein }}g</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  Fats
                  <span class="badge bg-primary rounded-pill">{{ nutrition.fats }}g</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  Carbs
                  <span class="badge bg-primary rounded-pill">{{ nutrition.carbs }}g</span>
                </li>
              </ul>
            </div>

            <div class="col-md-6 d-flex flex-column justify-content-center">
              <h5 class="fw-semibold">Recommendation:</h5>
              <p class="recommendation text-warning">{{ recommendation }}</p>

              {% if top_predictions %}
              <h5 class="fw-semibold mt-3">Top 3 Predictions:</h5>
              <ul class="list-group">
                {% for cls, prob in top_predictions %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  {{ cls }}
                  <span class="badge bg-secondary rounded-pill">{{ (prob * 100) | round(2) }}%</span>
                </li>
                {% endfor %}
              </ul>
              {% endif %}
            </div>
          </div>

          <!-- Button to reset/upload new image -->
          <form method="GET" class="mt-4">
            <button type="submit" class="btn btn-warning w-100">Upload New Image</button>
          </form>

          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
